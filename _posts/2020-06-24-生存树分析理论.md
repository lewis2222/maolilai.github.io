https://zhuanlan.zhihu.com/p/97645982  
 

生存树分析理论


[科普向] 生存分析简介-案例导向篇
滕佳烨
滕佳烨
知乎是娱乐工具不是学习软件（逃
​关注他
24 人赞同了该文章
这大概率会是本专栏的最后一篇文章，也是我最想写的一篇。本文将会从案例角度出发介绍生存分析（Survival Analysis），为了科普的目的，我尽量不使用任何一个公式，而表达清楚我想表达的概念。如果我的任何表述有不清楚或错误的地方，还请多多指正！废话不多说，我们直接开始吧！

案例一：她怎么死的？
上海市杨浦区的刘奶奶年龄四十九岁，在四十五岁的那一年参加了上海某医院的心脏病治疗中心，据传是世界上最先进的一种药。但药物还在研究阶段，因此费用几乎全免，刘奶奶一直觉得自己捡了个大便宜。每一年的大年初一，医院都会来给刘奶奶做上门检测，并采集刘奶奶的各种指标。这四年多来，奶奶的心脏病一直没有发作过。

直到刘奶奶四十九岁时，那是八月末，正在刘奶奶和路边的菜贩讨价还价之时，一辆醉驾的出租车横冲直撞，很遗憾，老奶奶没有幸运地逃离死神的魔爪。

同样遗憾的是，医院心脏病治疗研究中心对刘奶奶正在进行的实验无法继续下去了。要知道，寻找合适的、能够进行实验的患者并不是一件容易的工作。通常每个患者身后有着一大批医务人员的努力。因为一场突如其来的车祸，难道这个样本就损失掉了吗？

要知道，这个样本是携带药物信息的。它带给我们的信息是：刘奶奶的复发时间至少为4.6年，因为车祸离世不应该被归因于心脏病复发。我们没办法知道准确的数字，但却能够知道该数字的下界。如何把这样的信息合理地提取出来呢？

删掉数据，有点遗憾。留下数据，它又不精准。

事实上，这种不含数据精确值，只含其上界或下界的数据叫做删失数据 (Censored Data)。

生存分析的主要目标就是处理“相应变量是删失数据”的情况。

删失数据在生活中是很普遍的，例如：在进行实验时某被测成员退出实验；由于仪器的不精准导致某些样本测量有误；由于社会原因导致问卷调查失真……这些数据都可以被看作是删失的情况。而生存分析就是处理这种情况最有力的手段。



案例二：谁更容易死？是九十五岁的她，还是二十五岁的他？
九十五岁的张奶奶和二十五岁的李先生相爱了，并受到除了张奶奶一家人之外的所有人的支持。张奶奶一家人认为：二十五岁的李先生只是为了他们家的财产。李先生据理力争，并拿出了本省统计局的统计数字。统计数字表明：本省在2019年整年离世的人群中，有25%在二十至三十岁，而只有1%在九十岁至一百岁。李先生表示：这样的统计结果充分说明他的离世风险高于张奶奶，因此他怎么会是为了其财产呢？

看起来十分荒唐，但原因究竟在哪呢？

本质上来看，原因在于其模糊了风险一词。如何定义风险？李先生使用绝对数字，而九十以上岁的老人本就少于二十岁以上的人（基数少），因此每年离世的绝对数字当然就少。而正确的使用方法是使用相对数字：计算在已经活到九十岁的前提下，九十岁的老人活到一百岁的概率有多大。因此正确的比较中，我们应该分别除以一个基数。

从数学角度来看，对于一个连续型随机变量而言，绝对数字就是它的概率密度函数（PDF），而相对数字就是它的风险函数（hazard function）。名词是不重要的，我们只需要记住，在生存分析中，我们通常使用风险函数的概念来刻画已知在一个时间点上生存的人能够成功活到下一个相邻时间点（这两个时间点可以任意近）的相对概率，即生存风险。

注意：风险函数只能刻画相对概率，它本身并不是一个概率。



案例三：用药还是不用药，谁说了算？
二十五岁的李先生在被指出漏洞以后急火攻心，成功住院。然而在检查过程中医生惊奇地发现他患有一种罕见病。国际上对于该病的记录寥寥无几，但该医院曾研制过几种药物（A,B），也曾进行过对应的药物实验。只是还不知道：用药后病人的生存时间是否能够得到有效延长？

用药还是不用药呢？用药的话用哪种药呢？我们要数据来说话。

在生存分析中，我们关心一个患者的剩余寿命。如果我们把曾经所有接受过试验的患者画在一张图里，我们需要比较几组实验（不用药、用安慰剂、用药物A、用药物B）中的患者寿命。你可能会立马想到数理统计中的t检验，然而很遗憾，在删失条件下t检验是无效的。这是由于t检验基于样本平均值，而删失情况的均值是没有意义的。

因此，相较于普通统计对均值的关注，生存分析更关注于一批患者在每个时间点的存活率。将时间点作为横坐标，将一组样本在该时间点的存活率当作纵坐标，这样得到的曲线叫做生存函数(Survival Function)。


风险函数与生存函数样例。ab图、cd图互相对应。实际上，二者为一一对应的关系。
回到我们的问题，现在有四组带有删失的数据，我需要知道四组之间是否有显著差异。如何做呢？生存分析提供给我们三种方式：

第一种，利用Kaplan-Meier估计生存函数，然后用眼睛观察。这样就可以知道四组之间是否有显著差异。显然，这样的方法太过主观，许多时候我们只能看出来有差异，但却不知道差异多大的时候算显著。无论如何，我们一般需要将这种定性方法提升为定量方法。

第二种，利用Log-Rank Test对四组数据的差异显著性进行检验。这是一种定量的研究方法，很多时候都能得到很好的结论。但遗憾的是，当数据除了有治疗方法外，还有许多其他维度时（如患者的身高、血压、肺活量等），本检验效率极低。

第三种，利用回归的技巧。将治疗方法作为一个新的变量引入回归模型，这个模型也可以带有其他维度（如患者的身高、血压、肺活量等），并进行变量的显著性检验。在生存分析中，常见的回归技巧包括参数模型（Proportional Hazard Model, Accelerated Failure Time Model）、半参数模型（Rank Regression, Cox Regression）。通过检验回归模型的变量显著性，我们就可以了解治疗方法对患者生存时间的影响。



案例四：他，还能活多久？
在数据的帮助下，李先生确定了要使用药物A进行治疗。李先生的父亲已经年过半百，听到这个消息仍然非常难过，声音颤抖地问了医生一个问题：

“我家儿子，他……还能活多久？”

医生笑着说，放心吧，整体上来看，使用本药后五年存活率大约是80%，十年存活率大约是40%以上。您家儿子还年轻，体格又好，应该会活得更久的！

这个数字可不是医生瞎编的数字，也不是为了哄老爷子开心用的，而是真真实实可以算出来的数字。所用到的方法也是我们之前提到过的回归。

再次强调一遍，在生存分析中，常见的回归技巧包括参数模型（Proportional Hazard Model, Accelerated Failure Time Model）、半参数模型（Rank Regression, Cox Regression）。在实际应用中，我强烈推荐你首先使用Cox Regression。一般来说，它能够具有更好的回归效果。如果其效果不好，我甚至会推荐你使用Stratified Cox Regression，它是Cox Regression的一个延伸。这里我们多强调一句，这几个模型本质上都是线性模型（Linear Model）。

在回归过程中，比较重要的几个步骤分别包括：参数估计，参数推断，变量选择，模型诊断，参数解释。

参数估计主要是模型拟合数据的过程。在生存分析中，我们一般使用Newton-Raphson迭代算法求解模型参数的极大似然估计（Maximum Likelihood Estimator）。

参数推断主要是为了获得参数的置信区间。在生存分析中，我们一般使用Score统计量来获得参数置信区间。

变量选择主要是为了让模型更加精简，降低方差。我们可以使用和回归分析类似的逐步回归法进行变量选择，也可以通过Wald Test、Score Test、Likelihood Ratio Test等多种方式对模型的显著性水平进行判断，进而达到变量选择的效果。

模型诊断主要是为了查看模型是否可用。生存分析有它独特的残差（常见的为Deviance残差），你需要检验一下这些残差是否符合模型假设。

参数解释是统计模型与实际应用的桥梁。由于这几种回归都是线性模型，其参数具有丰富的解释意义。一般来说，参数代表了数据发生单位变动后的对应风险变化。注意：这只是一个不严格的说法，严谨的说法需要根据意义、根据模型结构进行重新说明。

经过这几个步骤，李先生已经可以得到生存曲线估计（包括生存函数、风险函数）。因为我们代入了他的生物信息（或许是身高、血压、肺活量），这份估计事实上只属于李先生一个人。当然，估计中也带有其他个体的实验信息（这些样本参与了参数估计的过程），我们可以认为我们充分提取了之前实验者的信息。拿着这样的结果，李先生的父亲终于能够快乐地表示：还行，还有活头。



一点小小的总结
希望通过这几个故事，您可以对生存分析的数据特点、研究目标、研究问题、研究方法有一个整体性的了解。

首先，生存分析研究的数据中，响应变量存在删失情况。这种删失是普遍的、无法避免的。因此传统的均值、标准差、以及相关的t检验等均无法进行使用。

因为问题背景的区别，生存分析的研究目标主要有风险函数与生存函数。风险函数代表了患者在每个时间点的相对死亡风险、生存函数代表了患者在每个时间点的生存率。

此外，生存分析重点关注两个问题。

一是识别组间差异。主要用的方法有Kaplan-Meier估计（经验性的）、Log-Rank检验（定量、主要用于变量维度较低且离散时）、回归（更加普遍通用）

二是进行预测。主要用的方法是回归，包括参数模型（Proportional Hazard Model, Accelerated Failure Time Model）、半参数模型（Rank Regression, Cox Regression, Stratified Cox Regression）。回归的步骤和普通数理统计别无二致，主要包括参数估计，参数推断，变量选择，模型诊断，参数解释。



最后的一点话
谢谢你看到这里，接下来胡乱写点矫情的话，希望你不会觉得很酸。

这个专栏最开始开设其实是因为我自己要期末考试，专栏里面所有文章都没带有任何科普的目的，就像我自己自娱自乐一样每天傻傻地打着公式，过着我自个儿的小日子。

在写的过程中，我也遇到了许多阻力。我也只是一个大四的学生，数理基础并没有多么扎实，很多地方我都要找人去问，去讨论。许多时候，我觉得我理解了，可反过来一想又不是那么回事，折腾折腾一天就过去了。这一周我自己的科研产出几乎是0，但我过得很充实。因为我很少能够为了一门考试这么努力、这么想要尽全力地去弄懂每一个知识点。以前的生活很得过且过，总觉得考到90也就可以了，没必要把地方都弄懂，直到写了这个专栏才发现，自己以为很懂却不懂的地方真的很多。

在上财，我最喜欢也最无奈的一点就是身边所有人对目标的高度专一。每个人都在考证、实习、刷简历。实话实说，在这样的环境下，我也星星点点地成为了这样的人。许多校外的人夸我专注、说我有目标，可是在上财的大环境下，我其实可以算是不学无术、自由散漫的代表人物。一直以来，我都很克制自己追目标的脚，我害怕我终会成为一名只为了某个目标活着的男大学生。

有些东西做起来没意义，因为做这件事本身就是它的意义。

我知道大部分人都不会接触生存分析，毕竟这个学科如此小众。比起常见的数理统计、甚至是高等数学，它能博得的眼球必然不多。所以在一开始写的时候就没想过让多少人看见这个专栏。我自私地觉得，知识就是要小众才够炫酷、够耍帅。

但是越写下去，我越想写点科普的内容了。我想，我们不该那么自大地让知识被供奉在高高的楼阁上。每次都要人虔诚地朝拜、却不告诉他朝拜的目的。越好的知识，就应该有人把它写得越浅显、越能让别人理解。我想这才是知识的意义。我自知文笔不佳、统计思想也不够深厚，但这篇文章的确是我花了许多心思写出来的，希望它能做到它应尽的作用。就算一直也没有人看，之后我也会尽量地去写一些我比较了解的知识内容的科普，不论是统计的、还是计算机的。

我大学的最后一门课是生存分析，那就把这篇文章、这个专栏，当做我大学学习生活的半个句号罢。

再次谢谢你看到了结尾，希望本文能够给在看的你一点点小小的帮助！





[生存分析] 专栏其他文章

Survival Analysis (0): Introduction

Survival Analysis (1): Preliminary

Survival Analysis (2): Likelihood

Survival Analysis (3): Censoring Mechanisms

Survival Analysis (4): Estimation of S(t)

Survival Analysis (5): Group Testing

Survival Analysis (6): Likelihood-based Test

Survival Analysis (7): Proportional Hazard Model-1

Survival Analysis (8): Proportional Hazard Model-2

Survival Analysis (9): AFT Model

Survival Analysis (10): Semi-parametric AFT Model

Survival Analysis (11): Cox Regression-1

Survival Analysis (12): Cox Regression-2

Survival Analysis (13): Model Diagnostics
